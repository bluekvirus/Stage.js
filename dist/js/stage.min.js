Swag.registerHelpers(),_.each(["document","window"],function(e){window["$"+e]=$(window[e])}),Application=new Backbone.Marionette.Application,_.each(["Core","Util"],function(e){Application.module(e)}),function(){Application.setup=function(e){Application.config=_.extend({theme:"default",template:"",contextRegion:"app",defaultContext:"Default",fullScreen:!1,rapidEventDebounce:200,baseAjaxURI:"/api",crossdomain:{protocol:"",host:"127.0.0.1",port:"5000",username:"admin",password:"123"}},e);var t=URI(window.location.toString()).search(!0).theme||Application.config.theme;return Application.Util.rollTheme(t),window.NProgress&&(Application.onAjaxStart=function(){NProgress.start()},Application.onAjaxStop=function(){NProgress.done()}),Application.onAjax=function(e){var t=Application.config.crossdomain;t.enabled&&(e.url=(t.protocol||"http")+"://"+(t.host||"localhost")+(t.port&&":"+t.port||"")+(/^\//.test(e.url)?e.url:"/"+e.url),e.crossDomain=!0,e.xhrFields=_.extend(e.xhrFields||{},{withCredentials:!0})),Modernizr.ie&&(e.cache=!1)},Application.addInitializer(function(e){function t(e,t){if(!e)throw new Error("DEV::Application::Empty context name...");var n=Application.Core.Context[e];if(!n)throw new Error("DEV::Application::You must have the requred context "+e+" defined...");if(!Application.currentContext||Application.currentContext.name!==e){Application.currentContext=new n,Application.Util.addMetaEvent(Application.currentContext,"context");if(!Application[Application.config.contextRegion])throw new Error("DEV::Application::You don't have region '"+Application.config.contextRegion+"' defined");Application[Application.config.contextRegion].show(Application.currentContext),Application.trigger("app:context-switched",Application.currentContext.name)}Application.currentContext.trigger("context:navigate-to",t)}Application.Util.addMetaEvent(Application,"app"),Application.onNavigate=function(e){_.isString(e)?window.location.hash="navigate/"+e:t(e.context,e.module)}}),Application.addInitializer(function(e){function n(e,n){var r={h:$window.height(),w:$window.width()};Application.config.fullScreen&&t.height(r.h),n||Application.trigger("app:resized",r)}function r(){var e=$window.scrollTop();Application.trigger("app:scroll",e)}var t=$("body");n(null,!0),$window.on("resize",_.debounce(n,Application.config.rapidEventDebounce)),$window.on("scroll",_.debounce(r,Application.config.rapidEventDebounce)),Application.config.fullScreen&&t.css({overflow:"hidden",margin:0,padding:0}),window.location.hash||(Application.Core.Context[Application.config.defaultContext]?window.location.hash=["#navigate",Application.config.defaultContext].join("/"):console.warn("DEV::Application::You might want to define a Default context using app.create('Context', {...})"))}),Application.on("initialize:after",function(e){var t=Backbone.Marionette.AppRouter.extend({appRoutes:{"(navigate)(/:context)(/:module)":"navigateTo"},controller:{navigateTo:function(e,t){Application.trigger("app:navigate",{context:e,module:t})}}});Application.router=new t,Backbone.history&&Backbone.history.start()}),Application},Application.run=function(){return $document.ready(function(){var e={},t=Application.Util.Tpl.build(Application.config.template);$("#main").html(t.string).find("[region]").each(function(t,n){var r=$(n).attr("region");e[r]='#main div[region="'+r+'"]'}),Application.addRegions(_.extend(e,{app:'div[region="app"]'})),_.each(e,function(e,t){Application[t].ensureEl();var n=Application.Core.Regional.get(Application[t].$el.addClass("app-region region region-"+_.string.slugify(t)).attr("view"));n&&Application[t].show(new n)}),Application.start()}),Application},Application.create=function(e,t){console.warn("DEV::Application::create() method is deprecated, use methods listed in Application._apis for alternatives")},_.extend(Application,{model:function(e){return new Backbone.Model(e)},collection:function(e){return new Backbone.Collection(e)},view:function(e,t){_.isBoolean(e)&&(t=e,e={});var n=Backbone.Marionette[e.type||"ItemView"].extend(e);return t?new n:n},context:function(e,t){return _.isString(e)||(t=e,e=""),t=t||{},_.extend(t,{name:e}),Application.Core.Context.create(t)},regional:function(e,t){return _.isString(e)||(t=e,e=""),t=t||{},_.extend(t,{name:e}),Application.Core.Regional.create(t)},widget:function(e,t){if(!_.isString(e))throw new Error("DEV::Application.widget::You must specify a widget name to use.");if(_.isFunction(t)){Application.Core.Widget.register(e,t);return}return Application.Core.Widget.create(e,t)},editor:function(e,t){if(!_.isString(e))throw new Error("DEV::Application.editor::You must specify a editor name to use.");if(_.isFunction(t)){Application.Core.Editor.register(e,t);return}return Application.Core.Editor.create(e,t)}}),Application.editor.validator=Application.editor.rule=function(e,t){if(!_.isString(e))throw new Error("DEV::Application.editor.validator::You must specify a validator/rule name to use.");return Application.Core.Editor.addRule(e,t)},Application.page=Application.context,Application.area=Application.regional,Application.remote=function(e){return e.payload?Application.Core.Remote.change(e):Application.Core.Remote.get(e)},Application._apis=["model","collection","context - @alias:page","regional - @alias:area","view","widget","editor","editor.validator - @alias:editor.rule","remote","create - @deprecated"]}(),function(e){e.Util.addMetaEvent=function(e,t,n){n||(n=e),e.listenTo(e,"all",function(r){var i=r.split(":");if(i.length!==2||i[0]!==t)return;var s=_.string.camelize("on-"+i[1]);n[s]&&n[s].apply(e,_.toArray(arguments).slice(1))})}}(Application),function(e){var t=function(t){$("#theme-roller").attr("href","themes/"+t+"/css/main.css"),e.currentTheme=t};e.Util.rollTheme=function(e){t(e)}}(Application),function(e){var t=function(e){var t=$("#hidden-download-iframe");t.length>0||($("body").append('<iframe id="hidden-download-iframe" style="display:none"></iframe>'),t=$("#hidden-download-iframe")),_.isString(e)&&(e={url:e}),t.attr("src",(new URI(e.url||"/")).search(_.omit(e,"url")).toString())};e.Util.download=t}(Application),function(e){var t={},n={build:function(e,n){if(arguments.length===0||_.string.trim(e)==="")return{id:"#_blank",tpl:" "};if(arguments.length===1){if(_.string.startsWith(e,"#"))return{id:e};n=e,e=_.uniqueId("tpl-gen-"),_.isArray(n)||(n=[n])}if(t[e])throw new Error("DEV::APP.Util.Template::Conflict! You have already named a template with id:"+e);var r=_.isArray(n)?n.join(""):n;return $("head").append(['<script type="text/tpl" id="',e,'">',r,"</script>"].join("")),t[e]=!0,{id:"#"+e,string:r}},get:function(e){return t[e]?$("head").find("#"+e).html():!1},list:function(){return _.keys(t)}};e.Util.Tpl=n}(Application),Application.Util.Tpl.build("_blank"," "),function(e,t,n){function i(n){if(!n)throw new Error("DEV::Core.Remote::options empty, you need to pass in at least a url string");if(t.isString(n))n={url:n,type:"GET"};else{t.extend(n,{type:undefined,data:undefined,processData:!1,contentType:"application/json; charset=UTF-8"});if(n.entity){var r=n.entity;n.url=[e.config.baseAjaxURI,r].join("/")}n.payload&&n.payload._id&&(n._id&&console.warn("DEV::Core.Remote::options.payload._id",n.payload._id,"overriding options._id",n._id),n._id=n.payload._id);if(n._id||n._method){var i=new URI(n.url);n.url=i.path(t.compact([i.path(),n._id,n._method]).join("/")).toString()}n.params=n.querys||n.params,n.params&&(n.url=(new URI(n.url)).search(n.params).toString())}return e.trigger("app:ajax",n),n}function s(t,n){return t.done(function(t,r,i){e.trigger("app:success",t,n)}).fail(function(t,r,i){e.trigger("app:error",i,n)}),t}var r=e.module("Core.Remote");t.extend(r,{get:function(t){return i(t),t.type="GET",e.trigger("app:remote-pre-get",t),s(n.ajax(t))},change:function(r){i(r);if(!r.payload)throw new Error("DEV::Core.Remote::payload empty, please use GET");return r.payload._id&&t.size(r.payload)===1?r.type="DELETE":(t.isObject(r.payload)||(r.payload={payload:r.payload}),r.payload._id?r.type="PUT":r.type="POST"),r.type!=="DELETE"&&(r.data=JSON.stringify(r.payload)),e.trigger("app:remote-pre-change",r),s(n.ajax(r))}}),$document.ajaxStart(function(){e.trigger("app:ajax-start")}),$document.ajaxStop(function(){e.trigger("app:ajax-stop")})}(Application,_,jQuery),function(e){function t(t){t=_.string.classify(t);var n=e.module("Core."+t);_.extend(n,{map:{},has:function(e){return n.map[e]?!0:!1},register:function(e,r){n.has(e)&&console.warn("DEV::Overriden::"+t+"."+e),n.map[e]=r()},create:function(e,r){if(n.has(e))return new n.map[e](r);throw new Error("DEV::"+t+".Registry:: required definition ["+e+"] not found...")}})}t("Widget"),t("Editor")}(Application),function(e,t){var n=e.module("Core.Context");t.extend(n,{create:function(e){return e.name=e.name||"Default",e.className="context context-"+t.string.slugify(e.name)+" "+(e.className||""),n[e.name]&&console.warn("DEV::Core.Context::You have overriden context '",e.name,"'"),n[e.name]=Backbone.Marionette.Layout.extend(e),n[e.name]}})}(Application,_),function(e,t,n){var r=e.module("Core.Regional"),i={};t.extend(r,{create:function(e){i[e.name]&&console.warn("DEV::Core.Regional::You have overriden regional view '",e.name,"'");var t=n[e.type||"Layout"].extend(e);return e.name?(i[e.name]=t,t):new t},get:function(e,t){var n=i[e];return t?new n(t):n}})}(Application,_,Marionette),Backbone.Marionette.TemplateCache.prototype.loadTemplate=function(e){return _.string.startsWith(e,"#")?$(e).html():_.isArray(e)?e.join(""):e},Backbone.Marionette.TemplateCache.prototype.compileTemplate=function(e){return Handlebars.compile(e)},function(e){_.extend(Backbone.Marionette.Region.prototype,{open:function(e){e.effect?(_.isString(e.effect)&&(e.effect={name:e.effect}),this.$el.hide(),this.$el.empty().append(e.el),this.$el.show(e.effect.name,e.effect.options,e.effect.duration||200)):this.$el.empty().append(e.el),this._parentLayout&&(e.parentCt=this._parentLayout),e.fieldset&&(this._parentLayout._fieldsets=this._parentLayout._fieldsets||{},this._parentLayout._fieldsets[e.fieldset]=e)}})}(Application),function(e){_.extend(Backbone.Marionette.View.prototype,{enableActionTags:function(e,t){this.enableUILocks(),_.isBoolean(e)&&(t=e,e=""),t=t||!1,this.events=this.events||{},_.extend(this.events,{"click [action]":"_doAction"}),this.actions=this.actions||{},e=e||this.name||"UNKNOWN.View",this._doAction=function(n){if(this.isUILocked()){n.stopPropagation(),n.preventDefault();return}var r=$(n.currentTarget),i=r.attr("action")||"UNKNOWN",s=i.split(":");if(s.length>=2)return s.shift(),n.stopPropagation(),this.trigger(s.join(":"));var o=this.actions[i];if(!o){if(t)return;throw n.stopPropagation(),new Error("DEV::"+(e||"UI Component")+"::You have not yet implemented this action - ["+i+"]")}n.stopPropagation(),o.apply(this,[r,n])}}}),_.extend(Backbone.Marionette.View.prototype,{enableUILocks:function(){this._uilocks=_.reduce(this.regions,function(e,t,n,r){return e[n]=!1,e},{_all:!1}),this.lockUI=function(e,t){e=this._checkRegion(e),t=t||"_default_";if(!this._uilocks[e])return this._uilocks[e]=t,!0;if(this._uilocks[e]===t)return!0;throw new Error("DEV::View::UI Locks::This region "+e+" is already locked by "+this._uilocks[e])},this.unlockUI=function(e,t){e=this._checkRegion(e),t=t||"_default_";if(!this._uilocks[e])return!0;if(this._uilocks[e]===t)return this._uilocks[e]=!1,!0;throw new Error("DEV::View::UI Locks::This region "+e+" is locked by "+this._uilocks[e]+", you can NOT unlock it with "+t)},this.isUILocked=function(e){return e=this._checkRegion(e),this._uilocks[e]},this._checkRegion=function(e){if(!this._uilocks)throw new Error("DEV::View::You need to enableUILocks() before you can use this...");if(!e)e="_all";else if(!this.regions||!this.regions[e])throw new Error("DEV::View::UI Locks::This region does NOT exist - "+e);return e}}}),_.extend(Backbone.Marionette.View.prototype,{enableTooltips:function(e){this.listenTo(this,"render",function(){this.$('[data-toggle="tooltip"]').tooltip(e)})}}),_.extend(Backbone.Marionette.View.prototype,{enableFlyTo:function(e){return e||(e="body"),_.isString(e)&&($anchor=$(e)),this.id=_.uniqueId("free-flow-"),this.flyTo=function(e){$("#"+this.id).length||(this.render().$el.attr("id",this.id).css("position","absolute"),$anchor.append(this.el),this.onShow&&this.onShow()),this.$el.show(),this.shown=!0,this.adjust=function(){this.shown&&this.$el.position(e)},this.adjust()},this.adjust=$.noop,this.hide=function(){this.$el.hide(),this.shown=!1},this}}),Backbone.Marionette.View.prototype.constructor=function(t){t=t||{};if(!_.isFunction(t)){this.template=t.template||this.template||" ";if(!this.ui&&!t.ui){var n=Backbone.Marionette.TemplateCache.prototype.loadTemplate(this.template);this.ui={};var r=this;$(["<",this.tagName,">",n,"</",this.tagName,">"].join("")).find("[ui]").each(function(e,t){var n=$(this).attr("ui");r.ui[n]='[ui="'+n+'"]'})}}return e.Util.addMetaEvent(this,"view"),this.actions&&this.enableActionTags(this.actions._bubble),this.editors&&this.activateEditors&&this.listenTo(this,"render",function(){this.activateEditors(this.editors)}),this.svg&&this.enableSVG&&this.listenTo(this,"render",this.enableSVG),this.tooltips&&this.enableTooltips(this.tooltips),Backbone.Marionette.View.apply(this,arguments)}}(Application),function(e){_.extend(Backbone.Marionette.ItemView.prototype,{enableSVG:function(){if(!Raphael)throw new Error("DEV::View::You did NOT have Raphael.js included in the libs.");var e=this;Raphael(this.el,this.$el.width(),this.$el.height(),function(){e.paper=this,e.trigger("view:paper-ready",this)}),this.onFitPaper=function(){if(!this.paper)return;this.paper.setSize(this.$el.width(),this.$el.height()),this.trigger("view:paper-resized")}}}),_.extend(Backbone.Marionette.ItemView.prototype,{activateEditors:function(t){this._editors=this._editors||{};if(this._editors.attachView)throw new Error("DEV::ItemView::activateEditors enhancements will need this._editors object, it is now a Region!");var n=t._global||{};_.each(t,function(t,r){if(r.match(/^_./))return;if(!_.isFunction(t)){t=_.extend({name:r,parentCt:this},n,t),t.type=t.type||"text";var i=e.Core.Editor.map[t.type]||e.Core.Editor.map.Basic,s=new i(t)}else{var i=t;t=_.extend({},n);var s=new i}this._editors[r]=s.render();var o=this.$('[editor="'+r+'"]');o.length===0&&t.appendTo&&(o=this.$(t.appendTo)),o.length===0&&(o=this.$el),o.append(s.el)},this),this.listenTo(this,"before:close",function(){_.each(this._editors,function(e){e.close()})});var r=_.pick(this,"getEditor","getValues","setValues","validate");this.getEditor=function(e){return this._editors[e]||r.getEditor&&r.getEditor.call(this,e)},this.getValues=function(){var e=r.getValues&&r.getValues.call(this)||{};return _.each(this._editors,function(t,n){var r=t.getVal();r!==undefined&&r!==null&&(e[n]=r)}),e},this.setValues=function(e,t){if(!e)return;_.each(this._editors,function(n,r){e[r]&&n.setVal(e[r],t)}),r.setValues&&r.setValues.call(this,e,t)},this.validate=function(e){var t=r.validate&&r.validate.call(this,e)||{};_.each(this._editors,function(n,r){var i=n.validate(e);i&&(t[r]=i)});if(_.size(t)===0)return;return t},this.status=function(e,t){t||(t=e,e="error");if(!t){_.each(this._editors,function(e,t){e.status(" ")});return}if(_.isString(t))throw new Error("DEV::ItemView::activateEditors - You need to pass in messages object");_.each(t,function(t,n){this._editors[n]&&(_.isString(t)?this._editors[n].status(e,t):this._editors[n].status(t.status||e,t.message))},this)}}}),_.extend(Backbone.Marionette.ItemView.prototype,{onRenderData:function(e){this.model||(this.model=new Backbone.Model,this.listenTo(this.model,"change",this.render)),this.model.set(e),this.trigger("view:data-rendered")}})}(Application),function(e){_.extend(Backbone.Marionette.Layout.prototype,{getValues:function(){var e={};return this.regionManager.each(function(t){t.currentView&&t.currentView.getValues&&(t.currentView.fieldset?e[t.currentView.fieldset]=t.currentView.getValues():_.extend(e,t.currentView.getValues()))}),e},setValues:function(e,t){this.regionManager.each(function(n){n.currentView&&n.currentView.setValues&&(n.currentView.fieldset?n.currentView.setValues(e[n.currentView.fieldset],t):n.currentView.setValues(e,t))})},validate:function(e){var t={};this.regionManager.each(function(n){n.currentView&&n.currentView.validate&&(n.currentView.fieldset?t[n.currentView.fieldset]=n.currentView.validate(e):_.extend(t,n.currentView.validate(e)))});if(_.size(t)===0)return;return t},getEditor:function(e){if(!e||_.isEmpty(e))return;_.isArray(e)||(e=e.split("."));var t=e.shift();if(this._fieldsets&&this._fieldsets[t])return this._fieldsets[t].getEditor(e.join("."));return}});var t=Backbone.Marionette.Layout;Backbone.Marionette.Layout=t.extend({constructor:function(n){n=n||{};if(!_.isFunction(n)&&!this.regions&&!n.regions){this.regions={};var r=Backbone.Marionette.TemplateCache.prototype.loadTemplate(n.template||this.template),i=this;$(["<",this.tagName,">",r,"</",this.tagName,">"].join("")).find("[region]").each(function(e,t){var n=$(t).attr("region");i.regions[n]={selector:'[region="'+n+'"]'}}),this.listenTo(this,"render",function(){_.each(this.regions,function(e,t){this[t].ensureEl(),this[t].$el.addClass("region region-"+_.string.slugify(t)),this[t]._parentLayout=this},this)}),this.listenTo(this,"show",function(){_.each(this.regions,function(t,n){this.debug&&this[n].$el.html('<p class="alert alert-info">Region <strong>'+n+"</strong></p>"),this[n].listenTo(this[n],"region:load-view",function(t,n){if(!t)return;if(e.Core.Widget.has(t)){this.show(e.Core.Widget.create(t,n));return}var r=e.Core.Regional.get(t);if(!r)throw new Error("DEV::Layout::View required "+t+" can NOT be found...use app.create('Regional', {name: ..., ...}).");this.show(new r(n))}),this[n].trigger("region:load-view",this[n].$el.attr("view"))},this)})}return t.prototype.constructor.call(this,n)}})}(Application),function(e){_.extend(Backbone.Marionette.View.prototype,{onRenderData:function(e){if(!_.isArray(e))throw new Error("DEV::CollectionView+::You need to have an array passed in as data...");this.collection||(this.collection=new Backbone.Collection,this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this.render)),this.collection.reset(e),this.trigger("view:data-rendered")},onLoadPage:function(t){t=_.extend({page:1,pageSize:15,dataKey:"payload",totalKey:"total",params:{}},this._remote,t),_.each(["params","querys"],function(e){if(!t[e])return;_.extend(t[e],{offset:(t.page-1)*t.pageSize,size:t.pageSize})});var n=this;e.remote(_.omit(t,"page","pageSize","dataKey","totalKey")).done(function(e){n.trigger("view:render-data",e[t.dataKey]),n.trigger("view:page-changed",{current:t.page,total:Math.ceil(e[t.totalKey]/t.pageSize)}),n._remote=t})}})}(Application);var I18N={};(function(e,t,n){function l(){o&&store.set(a,u)}function c(){function n(t){e.push("## module: "),e.push(t),e.push(" ##"),e.push("\n")}function r(t,n){t=new String(t),n=new String(n),e.push('"'),e.push(t.replace(/"/g,'\\"')),e.push('"'),e.push("="),e.push(n),e.push("\n")}var e=[];t.each(u,function(e,i){typeof e=="object"?t.each(e,function(e,t){t!=="_default"&&n(t),r(i,e)}):r(i,e)});var i=e.join("");return i}function h(){return JSON.stringify({locale:s,trans:u})}function p(t,n){var r=e(n),i=r.data("i18nKey"),s=r.data("i18nModule");i==="*"&&(i=e.trim(r.html())),r.html(i.i18n({module:s}))}var r={resourcePath:"static/resource",translationFile:"i18n.json"};I18N.configure=function(e){t.extend(r,e)};var i=n(window.location.toString()).search(!0),s=i.locale,o=i.localizer,u;if(s){e.ajax({url:[r.resourcePath,s,r.translationFile].join("/"),async:!1,success:function(e,t,n){u=e.trans},error:function(e,t,n){throw new Error("RUNTIME::i18n::"+n)}}),u=u||{};if(o){var a=["resources_",s].join(""),f=store.get(a);f&&t.each(f,function(e,n){if(!e)return;if(!u[n]){u[n]=e;return}t.isString(u[n])?u[n]=e:t.isObject(u[n])&&t.isObject(e)&&t.extend(u[n],e)})}}String.prototype.i18n=function(t){var n=e.trim(this);if(!s||!n)return n;var r=u[n];if(typeof r=="undefined")return u[n]="",l(),n;if(typeof r=="object"){var i=t&&t.module||"_default";r=r[i];if(typeof r=="undefined")return u[n][i]="",l(),n}return r=new String(r),r.trim()===""?n:r},window.getResourceProperties=c,window.getResourceJSON=h,window.clearResourceCache=function(){var e=["resources_",s].join("");store.remove(e)},Handlebars&&Handlebars.registerHelper("i18n",function(e,t,n){return n||(n=t,t=undefined),String(e).i18n(t&&{module:t})}),e.fn.i18n=function(e){return e=t.extend({search:!1},e),e.search?(this.find("[data-i18n-key]").each(p),this):this.filter("[data-i18n-key]").each(p)}})(jQuery,_,URI),function(e){function t(e,t){var n=window.hljs;n&&(n.configure(t&&t.hljs),e.find("pre code").each(function(){n.highlightBlock(this)}))}e.fn.md=function(n){var r=this;return _.isString(n)&&(n={url:n}),n=n||{},this.each(function(r,i){var s=e(i),o=n.url||s.attr("md")||s.data("md");e.get(o).done(function(e){s.html(marked(e,n.marked)).addClass("md-content"),t(s,n),n.cb&&n.cb(s)})})}}(jQuery),function(e){function r(n,r){r=_.extend({ignoreRoot:!1,headerHTML:""},r);var i=[],s=e("<div></div>").append(r.headerHTML).append("<ul></ul>");s.$children=s.find("> ul").data("children",[]);var o=s,u=r.ignoreRoot?1:0;n.find((r.ignoreRoot?"":"h1,")+"h2,h3,h4,h5,h6").each(function(){var n=e(this),r=n.context.localName,s=n.html(),a=n.attr("id");i.push(n);var f=e('<li><a href="#" data-id="'+a+'" action="goTo">'+s+"</a><ul></ul></li>");f.data({title:s,id:a});switch(r){case"h2":case"H2":f.addClass("chapter");break;case"h3":case"H3":f.addClass("section");break;default:}f.$children=f.find("> ul").data("children",[]);var l=t[r]-u;if(l>0)f.$parent=o,o.$children.append(f).data("children").push(f),u++;else if(l===0)f.$parent=o.$parent,o.$parent.$children.append(f).data("children").push(f);else{while(l<0)l++,o=o.$parent,u--;f.$parent=o.$parent,o.$parent.$children.append(f).data("children").push(f)}o=f,n.data("toc-node",f)}),n.data("toc",{html:'<div class="md-toc">'+s.html()+"</div>",$headers:i})}var t={};for(var n=1;n<=6;n++)t["h"+n]=t["H"+n]=n;e.fn.toc=function(t){return this.each(function(n,i){var s=e(i);r(s,t)})}}(jQuery),function(e){var t=Handlebars.compile(['<div class="overlay {{class}}" style="position:absolute; top: 0; left: 0; right: 0; bottom: 0; {{#unless class}}z-index:{{zIndex}};background:{{background}};{{/unless}}">','<div class="overlay-outer" style="display: table;table-layout: fixed; height: 100%; width: 100%;">','<div class="overlay-inner" style="display: table-cell;text-align: center;vertical-align: middle; width: 100%;">','<div class="overlay-content-ct" style="display: inline-block;outline: medium none; position:relative;">',"</div>","</div>","</div>","</div>"].join(""));e.fn.overlay=function(n,r){return _.isObject(n)&&(r=n,n=!0),_.isUndefined(n)&&(n=!1),r=r||{},this.each(function(i,s){var o=e(this);if(!n){if(!o.data("overlay"))return;var u=o.data("overlay");r=_.extend({},u.data("closeOptions"),r),u.hide({effect:r.closeEffect||r.effect||"clip",complete:function(){r.onClose&&r.onClose(o,u),$window.off("resize",u.data("onResize")),u.remove(),o.css({overflowY:o.data("overflow").y,overflowX:o.data("overflow").x}),o.removeData("overlay","overflow")}})}else{if(o.data("overlay"))return;r=_.extend({zIndex:100,background:r.content?"rgba(0, 0, 0, 0.7)":"none",move:!1,resize:!1},r),u=e(t(r)),o.data("overflow",{x:o.css("overflowX"),y:o.css("overflowY")}),o.append(u).css({position:"relative",overflow:"hidden"}),o[0].tagName==="BODY"&&(u.offset({top:$window.scrollTop()}),u.height($window.height()),u.data("onResize",function(){u.height($window.height())}),$window.on("resize",u.data("onResize"))),u.hide(),o.data("overlay",u),$container=u.find(".overlay-content-ct"),r.resize&&$container.resizable({containment:"parent"}),r.move&&$container.draggable({containment:"parent"}),u.data({closeOptions:_.pick(r,"closeEffect","effect","duration","onClose"),container:$container}),u.data("container").html(_.isFunction(r.content)?r.content(o,u):r.content),u.show({effect:r.openEffect||r.effect||"clip",complete:function(){r.onShow&&r.onShow(o,u)}})}})}}(jQuery),function(e){e.Core.Editor.register("Basic",function(){var t=Backbone.Marionette.ItemView.extend({template:"#editor-basic-tpl",className:"form-group",events:{change:"_triggerEvent","keyup input, textarea":"_triggerEvent",focusout:"_triggerEvent",focusin:"_triggerEvent"},initialize:function(t){this.parentCt=t.parentCt;if(t.type in{select:!0,radios:!0,checkboxes:!0}){switch(t.type){case"radios":t.type="radio";break;case"checkboxes":t.type="checkbox";default:}t.options=t.options||{},t.options=_.extend({data:[],valueField:"value",labelField:"label"},t.options);var n=t.options;function r(e){return _.isObject(e[0])?e=_.map(e,function(e){return{value:e[n.valueField],label:e[n.labelField]}}):e=_.map(e,function(e){return{value:e,label:_.string.titleize(e)}}),e}function i(e){return _.isArray(e.data)||(e.grouped=!0),e.grouped?_.each(e.data,function(t,n){e.data[n]=r(t)}):e.data=r(e.data),e}n.remote?this.listenToOnce(this,"render",function(){var t=this;e.remote(n.remote).done(function(e){t.setChoices(e)})}):i(t.options),this.setChoices=function(e){var t=this.model.get("options");t.data=e,this.model.set("options",i(t)),this.render()}}this.model=new Backbone.Model({uiId:_.uniqueId("basic-editor-"),layout:t.layout||"",name:t.name,type:t.type,multiple:t.multiple||!1,rows:t.rows||3,fieldname:t.fieldname||undefined,label:t.label||"",placeholder:t.placeholder||"",help:t.help||"",tooltip:_.isString(t.tooltip)&&t.tooltip||"",options:t.options||undefined,boxLabel:t.boxLabel||"",value:t.value,checked:t.checked||!0,unchecked:t.unchecked||!1}),t.validate&&(this.validators=_.map(t.validate,function(e,t){return _.isFunction(e)?{fn:e}:{rule:t,options:e}}),this.validate=function(n){if(!this.isEnabled())return;if(_.isFunction(t.validate)){var r=t.validate(this.getVal(),this.parentCt);return n&&this._followup(r),r}var r,i=_.clone(this.validators);while(i.length>0){var s=i.shift();s.fn?r=s.fn(this.getVal(),this.parentCt):r=e.Core.Editor.rules[s.rule]&&e.Core.Editor.rules[s.rule](s.options,this.getVal(),this.parentCt);if(!_.isEmpty(r))break}return n&&this._followup(r),r},this._followup=function(e){_.isEmpty(e)?(this.status(" "),this.eagerValidation=!1):(this.status("error",e),this.eagerValidation=!0)},this.listenTo(this,"editor:change editor:keyup",function(){this.eagerValidation&&this.validate(!0)})),t.tooltip&&this.enableTooltips(_.isObject(t.tooltip)?t.tooltip:{});if(t.type==="file"){this.listenTo(this,"editor:change",function(){this.ui.input.val()?(this.ui.upload.removeClass("hide").show(),this.ui.clearfile.removeClass("hide").show()):(this.ui.upload.hide(),this.ui.clearfile.hide())}),this.enableActionTags("Editor.File");if(!t.upload||!t.upload.url)throw new Error("DEV::Editor.Basic.File::You need options.upload.url to point to where to upload the file.");this.onRender=function(){var e=this;this.$el.fileupload({url:_.isFunction(t.upload.url)?t.upload.url():t.upload.url,fileInput:null,add:function(n,r){r.submit().success(function(n,r,i){t.upload.cb&&t.upload.cb(e,n,r,i)})}})},_.extend(this.actions,{clear:function(){this.setVal("",!0)},upload:function(){this.$el.fileupload("add",{fileInput:this.ui.input})}})}},isEnabled:function(){return!this._inactive},disable:function(e){e===!1?this._inactive=!1:this._inactive=!0;if(_.isUndefined(e)){this.ui.input.prop("disabled",!0);return}e?this.$el.hide():(this.ui.input.prop("disabled",!1),this.$el.show())},setVal:function(e,t){this.ui.inputs.length>0?this.ui.inputs.find("input").val(_.isArray(e)?e:[e]):this.ui["input-ro"].length>0?(e=_.escape(e),this.ui["input-ro"].data("value",e).html(e)):(this.model.get("type")==="checkbox"&&e===this.model.get("checked")&&this.ui.input.prop("checked",!0),this.ui.input.val(e)),t&&this._triggerEvent({type:"change"})},getVal:function(){if(!this.isEnabled())return;if(this.ui.inputs.length>0){var e=this.$("input:checked").map(function(e,t){return $(this).val()}).get();return this.model.get("type")==="radio"&&(e=e.pop()),e}return this.model.get("type")==="checkbox"?this.ui.input.prop("checked")?this.model.get("checked")||!0:this.model.get("unchecked")||!1:this.ui.input.val()},validate:$.noop,status:function(e,t){if(!e)return this.$el.data("status");var n="has-"+e;this.$el.removeClass(this.$el.data("status")).addClass(n).data("status",n),this.ui.msg.html(t||"")},_triggerEvent:function(e){var t=this;t.trigger("editor:"+e.type,this.model.get("name"),this),this.parentCt&&(t=this.parentCt),t.trigger("editor:"+e.type,this.model.get("name"),this)}});return t}),e.Util.Tpl.build("editor-basic-tpl",['<label class="control-label {{#if layout}}{{layout.label}}{{/if}}" for="{{uiId}}">{{label}}</label>','<div class="{{#if layout}}{{layout.field}}{{/if}}" data-toggle="tooltip" title="{{tooltip}}">','{{#is type "select"}}','<select ui="input" name="{{#if fieldname}}{{fieldname}}{{else}}{{name}}{{/if}}" class="form-control" id="{{uiId}}" {{#if multiple}}multiple="multiple"{{/if}} style="margin-bottom:0">',"{{#if options.grouped}}","{{#each options.data}}",'<optgroup label="{{@key}}">',"{{#each this}}",'<option value="{{value}}">{{label}}</option>',"{{/each}}","</optgroup>","{{/each}}","{{else}}","{{#each options.data}}",'<option value="{{value}}">{{label}}</option>',"{{/each}}","{{/if}}","</select>","{{else}}",'{{#is type "textarea"}}','<textarea ui="input" name="{{#if fieldname}}{{fieldname}}{{else}}{{name}}{{/if}}" class="form-control" id="{{uiId}}" rows="{{rows}}" placeholder="{{placeholder}}" style="margin-bottom:0"></textarea>',"{{else}}","{{#if options}}",'<div ui="inputs" id={{uiId}}>',"{{#each options.data}}",'{{#unless ../options.inline}}<div class="{{../../type}}">{{/unless}}','<label class="{{#if ../options.inline}}{{../../type}}-inline{{/if}}">','<input ui="input" name="{{#if ../fieldname}}{{../../fieldname}}{{else}}{{../../name}}{{/if}}{{#is ../type "checkbox"}}[]{{/is}}" type="{{../type}}" value={{value}}> {{label}}',"</label>","{{#unless ../options.inline}}</div>{{/unless}}","{{/each}}","</div>","{{else}}",'<div class="{{type}}">','{{#is type "checkbox"}}',"<label>",'<input ui="input" name="{{#if fieldname}}{{fieldname}}{{else}}{{name}}{{/if}}" type="checkbox" value="{{value}}"> {{boxLabel}}',"</label>","{{else}}",'{{#is type "ro"}}','<div ui="input-ro" data-value="{{{value}}}" class="form-control-static">{{{value}}}</div>',"{{else}}",'<input ui="input" name="{{#if fieldname}}{{fieldname}}{{else}}{{name}}{{/if}}" {{#isnt type "file"}}class="form-control"{{else}} style="display:inline;" {{/isnt}} type="{{type}}" id="{{uiId}}" placeholder="{{placeholder}}" value="{{value}}"> <!--1 space-->','{{#is type "file"}}','<span action="upload" class="hide file-upload-action-trigger" ui="upload" style="cursor:pointer;"><i class="glyphicon glyphicon-upload"></i> <!--1 space--></span>','<span action="clear" class="hide file-upload-action-trigger" ui="clearfile"  style="cursor:pointer;"><i class="glyphicon glyphicon-remove-circle"></i></span>','<span ui="result" class="file-upload-result"></span>',"{{/is}}","{{/is}}","{{/is}}","</div>","{{/if}}","{{/is}}","{{/is}}",'{{#if help}}<span class="help-block" style="margin-bottom:0"><small>{{help}}</small></span>{{/if}}','<span class="help-block input-error" ui="msg">{{msg}}</span>',"</div>"])}(Application),function(e){e.Core.Editor.rules={required:function(e,t,n){if(!t)return _.isObject(e)&&e.msg||"This field is required"}},e.Core.Editor.addRule=function(t,n){if(!t||!_.isFunction(n))throw new Error("DEV::Editor::Basic validation rule must have a name and a function implementation.");e.Core.Editor.rules[t]&&console.warn("DEV::Editor::Basic validation rule name ["+t+"] is already defined."),e.Core.Editor.rules[t]=n}}(Application),function(e){e.widget("Datagrid",function(){var t=e.view({type:"Layout",tagName:"table",template:['<thead region="header"></thead>','<tbody region="body"></tbody>'],initialize:function(e){this._options=_.extend({data:[],details:!1,columns:[]},e)},onShow:function(){this.header.show(new n),this.body.show(new i({el:this.body.$el})),this.trigger("view:reconfigure",this._options)},onReconfigure:function(e){e=e||{},this._options.data=e.data||this._options.data,_.each(e.columns,function(e){},this),_.each(this._options.columns,function(e){e.header=e.header||"string",e.cell=e.cell||e.header||"string",e.label=e.label||_.string.titleize(e.name)}),this.header.currentView.trigger("view:render-data",this._options.columns),this.body.currentView._options=this._options,this.body.currentView.trigger("view:render-data",this._options.data)},onRenderData:function(e){this.trigger("view:reconfigure",{data:e})}}),n=e.view({type:"CollectionView",itemView:"dynamic",tagName:"tr",buildItemView:function(t,n,r){return e.widget(_.string.classify([t.get("header"),"header","cell"].join("-")),{model:t,tagName:"th"})}}),r=e.view({type:"CollectionView",itemView:"dynamic",tagName:"tr",buildItemView:function(t,n,r){return e.widget(_.string.classify([t.get("cell"),"cell"].join("-")),{model:t,tagName:"td",row:this})}}),i=e.view({type:"CollectionView",itemView:r,itemViewOptions:function(t,n){return{collection:e.collection(_.map(this._options.columns,function(e){return _.extend({value:selectn(e.name||"",t.attributes),index:n},e)},this))}}});return t})}(Application),function(e){e.widget("StringHeaderCell",function(){var t=e.view({template:'<span><i class="{{icon}}"></i> {{{label}}}</span>'});return t})}(Application),function(e){e.widget("StringCell",function(){var t=e.view({template:"<span>{{{value}}}</span>"});return t})}(Application),function(e){e.widget("SeqCell",function(){var t=e.view({template:"{{index}}"});return t})}(Application),function(e){e.widget("ActionCell",function(){var t=e.view({template:["{{#each actions}}",'<span class="action-cell-item" action="{{@key}}" data-toggle="tooltip" title="{{tooltip}}"><i class="{{icon}}"></i> {{label}}</span> ',"{{/each}}"],className:"action-cell",initialize:function(e){this.row=e.row;var t=this.model.get("actions")||[];_.each({preview:{icon:"fa fa-eye",tooltip:"Preview"},edit:{icon:"fa fa-edit",tooltip:"Edit"},"delete":{icon:"fa fa-trash-o",tooltip:"Delete"}},function(e,n){t[n]?t[n]=_.extend(e,t[n]):t[n]=e}),this.actions=this.actions||{},_.each(t,function(e,t){e.fn&&(this.actions[t]=function(t){e.fn.apply(this.row,arguments)})},this),this.model.set("actions",t),this.enableActionTags(!0)},tooltips:!0});return t})}(Application),function(e){e.widget("Tree",function(){var t={type:"CompositeView",tagName:"li",itemViewContainer:"ul",itemViewOptions:function(){return{parent:this}},className:function(){return _.size(this.model.get("children"))>=1?"node":"leaf"},initialize:function(t){this.parent=t.parent,this.className()==="node"&&(this.collection=e.collection(this.model.get("children"))),this.listenTo(this,"render",function(){this.$el.addClass("clickable").data({record:this.model.attributes,$children:this.$el.find("> ul"),$parent:this.parent&&this.parent.$el})})},template:['<a href="#"><i class="{{icon}}"></i> {{{val}}}</a>',"<ul></ul>"]},n=e.view({type:"CollectionView",className:"tree tree-root",tagName:"ul",initialize:function(n){this._options=n,this.itemView=this._options.itemView||e.view(_.extend({},t,_.omit(this._options.node,"type","tagName","itemViewContainer","itemViewOptions","className","initialize"))),this.onSelected=n.onSelected||this.onSelected},onShow:function(){this.trigger("view:reconfigure",this._options)},onReconfigure:function(e){_.extend(this._options,e),this.trigger("view:render-data",this._options.data)},events:{"click .clickable":function(e){e.stopPropagation();var t=$(e.currentTarget);this.trigger("view:selected",t.data(),t,e)}},onSelected:function(e,t,n){}});return n})}(Application),function(e){e.widget("Paginator",function(){var t=e.view({className:"pagination",tagName:"ul",template:['<li {{#if atFirstPage}}class="disabled"{{/if}}><a href="#" action="goToAdjacentPage" data-page="-">&laquo;</a></li>',"{{#each pages}}",'<li {{#if isCurrent}}class="active"{{/if}}><a href="#" action="goToPage" data-page="{{number}}">{{number}} <span class="sr-only">(current)</span></a></li>',"{{/each}}",'<li {{#if atLastPage}}class="disabled"{{/if}}><a href="#" action="goToAdjacentPage" data-page="+">&raquo;</a></li>'],initialize:function(e){this._options=e||{},e.target&&this.listenTo(e.target,"view:page-changed",function(e){this.trigger("view:reconfigure",{currentPage:e.current,totalPages:e.total})})},onShow:function(){},onReconfigure:function(e){_.extend(this._options,e);var t={atFirstPage:this._options.currentPage===1,atLastPage:this._options.currentPage===this._options.totalPages,pages:_.map(_.range(1,this._options.totalPages+1),function(e){return{number:e,isCurrent:e===this._options.currentPage}},this)};this.trigger("view:render-data",t)},actions:{goToPage:function(e,t){t.preventDefault();var n=e.data("page");if(n===this._options.currentPage)return;this.trigger("view:change-page",n)},goToAdjacentPage:function(e,t){t.preventDefault();var n=this._options.currentPage,r=e.data("page");r==="+"?n++:n--;if(n<1||n>this._options.totalPages)return;this.trigger("view:change-page",n)}},onChangePage:function(e){this._options.target&&this._options.target.trigger("view:load-page",{page:e})}});return t})}(Application);