(function(e){e.widget("Datagrid",function(){var t=e.view({tagName:"table",template:['<thead region="header"></thead>','<tbody region="body"></tbody>'],initialize:function(e){this.options=_.extend({data:[],details:!1,columns:[]},e)},onReady:function(){this.trigger("view:reconfigure",_.extend(this.options,{data:this.get("items",[])}))},onReconfigure:function(e){e=e||{},this.options=_.extend(this.options,e),_.each(this.options.columns,function(e){e.header=e.header||"string",e.cell=e.cell||e.header||"string",e.label=e.label||_.string.titleize(e.name)}),this.header.currentView||this.header.show(n.create({grid:this}));if(!this.body.currentView){var t=this,r=i.create({el:this.body.$el,grid:this}).on("all",function(e){/page-/.test(e)&&t.trigger.apply(t,arguments)});this.body.show(r)}this.header.currentView.set(this.options.columns),this.body.currentView.options=this.options,this.trigger("view:set-grid-data",this.options.data)},onSetGridData:function(e){this.body.currentView.set(e)},onLoadPage:function(e){this.body.currentView.trigger("view:load-page",e)},getBody:function(){return this.body.currentView},getHeader:function(){return this.header.currentView}}),n=e.view({type:"CollectionView",forceViewType:!0,itemView:"dynamic",itemViewEventPrefix:"headercell",tagName:"tr",initialize:function(e){this.grid=e.grid},buildItemView:function(t,n,r){var i=e.get(_.string.classify([t.get("header"),"header","cell"].join("-")),"Widget");return i.create({model:t,tagName:"th",row:this})}}),r=e.view({type:"CollectionView",forceViewType:!0,itemView:"dynamic",itemViewEventPrefix:"cell",tagName:"tr",triggers:{click:{event:"clicked",preventDefault:!1},dblclick:{event:"dblclicked",preventDefault:!1}},initialize:function(e){this.grid=e.body.grid},buildItemView:function(t,n,r){var i=e.get(_.string.classify([t.get("cell"),"cell"].join("-")),"Widget");return i.create({tagName:"td",model:t,row:this})}}),i=e.view({type:"CollectionView",forceViewType:!0,itemView:r,itemViewEventPrefix:"row",initialize:function(e){this.grid=e.grid},itemViewOptions:function(t,n){return{collection:e.collection(_.map(this.options.columns,function(r){return _.extend({value:e.extract(r.name||"",t.attributes),index:n},r)},this)),body:this}},itemEvents:{clicked:function(e,t){t.grid.trigger("row:clicked",t)},dblclicked:function(e,t){t.grid.trigger("row:dblclicked",t)}}});return t})})(Application),function(e){e.widget("StringHeaderCell",function(){var t=e.view({template:'<span><i class="{{icon}}"></i> {{{i18n label}}}</span>'});return t})}(Application),function(e){e.widget("StringCell",function(){var t=e.view({template:"<span>{{{value}}}</span>"});return t})}(Application),function(e){e.widget("SeqCell",function(){var t=e.view({template:"{{index}}"});return t})}(Application),function(e){e.widget("ActionCell",function(){var t=e.view({template:["{{#each actions}}",'<span class="action-cell-item" action="{{@key}}" data-toggle="tooltip" title="{{i18n tooltip}}"><i class="{{icon}}"></i> {{i18n label}}</span> ',"{{/each}}"],className:"action-cell",initialize:function(e){this.row=e.row;var t=this.model.get("actions")||{};_.each({preview:{icon:"glyphicon glyphicon-eye-open",tooltip:"Preview"},edit:{icon:"glyphicon glyphicon-pencil",tooltip:"Edit"},"delete":{icon:"glyphicon glyphicon-remove",tooltip:"Delete"}},function(e,n){t[n]&&(t[n]=_.extend(e,t[n]))}),this.actions=this.actions||{},_.each(t,function(e,t){e.fn&&(this.actions[t]=function(t){e.fn.apply(this.row,arguments)})},this),this.model.set("actions",t),this._enableActionTags(!0)},tooltips:!0});return t})}(Application),function(e){e.widget("Tree",function(){var t={type:"CompositeView",forceViewType:!0,tagName:"li",itemViewContainer:"ul",itemViewOptions:function(){return{parent:this}},className:function(){return _.size(this.model.get("children"))>=1?"node":"leaf"},initialize:function(t){this.parent=t.parent,this.className()==="node"&&(this.collection=e.collection(this.model.get("children"))),this.listenTo(this,"render",function(){this.$el.addClass("clickable").data({view:this,$children:this.$el.find("> ul"),$parent:this.parent&&this.parent.$el})})},template:['<a class="item" href="#"><i class="type-indicator"></i> <i class="{{icon}}"></i> {{{i18n val}}}</a>','<ul class="children hidden"></ul>']},n=e.view({type:"CollectionView",forceViewType:!0,className:"tree tree-root",tagName:"ul",initialize:function(n){this.itemView=this.options.itemView||e.view(_.extend({},t,_.omit(this.options.node,"type","tagName","itemViewContainer","itemViewOptions","className","initialize"))),this.onSelected=n.onSelected||this.onSelected},onShow:function(){this.trigger("view:reconfigure",this.options)},onReconfigure:function(e){_.extend(this.options,e),this.trigger("view:render-data",this.options.data)},events:{"click .clickable":function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.data();t.hasClass("node")&&this.trigger("view:toggleChildren",n),this.trigger("view:selected",t.data(),t,e)}},onToggleChildren:function(e){e.$children.toggleClass("hidden"),e.view.$el.toggleClass("expanded")},onSelected:function(e,t,n){}});return n})}(Application),function(e){e.widget("Paginator",function(){var t=e.view({className:"pagination",tagName:"ul",template:['<li {{#if atFirstPage}}class="disabled"{{/if}}><a href="#" action="goToFirstPage" data-page="--">'+_.escape("<<")+"</a></li>",'<li {{#if atFirstWindow}}class="hidden"{{/if}}><a href="#" action="goToAdjacentWindow" data-window="-">...</a></li>',"{{#each pages}}",'<li {{#if isCurrent}}class="active"{{/if}}><a href="#" action="goToPage" data-page="{{number}}">{{number}} <span class="sr-only">(current)</span></a></li>',"{{/each}}",'<li {{#if atLastWindow}}class="hidden"{{/if}}><a href="#" action="goToAdjacentWindow" data-window="+">...</a></li>','<li {{#if atLastPage}}class="disabled"{{/if}}><a href="#" action="goToLastPage" data-page="++">'+_.escape(">>")+"</a></li>"],initialize:function(e){this.options=_.extend({pageWindowSize:5},e),e.target&&this.listenTo(e.target,"view:page-changed",function(e){this.trigger("view:reconfigure",{currentPage:e.current,totalPages:e.total})})},onShow:function(){},onReconfigure:function(e){_.extend(this.options,e),this.options.currentWindow=Math.ceil(this.options.currentPage/this.options.pageWindowSize);var t={atFirstPage:this.options.currentPage===1,atLastPage:this.options.currentPage===this.options.totalPages,atFirstWindow:this.options.currentWindow===1,atLastWindow:this.options.currentWindow===Math.ceil(this.options.totalPages/this.options.pageWindowSize),pages:_.reduce(_.range(1,this.options.totalPages+1),function(e,t){return t>(this.options.currentWindow-1)*this.options.pageWindowSize&&t<=this.options.currentWindow*this.options.pageWindowSize&&e.push({number:t,isCurrent:t===this.options.currentPage}),e},[],this)};this.trigger("view:render-data",t)},actions:{goToPage:function(e,t){var n=e.data("page");if(n===this.options.currentPage)return;this.trigger("view:change-page",n)},goToFirstPage:function(e,t){this.trigger("view:change-page",1)},goToLastPage:function(e,t){this.trigger("view:change-page",this.options.totalPages)},goToAdjacentWindow:function(e,t){var n=this.options.currentWindow,r=e.data("window");r==="+"?n++:n--;if(n<1||n>Math.ceil(this.options.totalPages/this.options.pageWindowSize))return;this.trigger("view:change-page",n==1?1:(n-1)*this.options.pageWindowSize+1)}},onChangePage:function(e){if(this.options.onChangePage)return this.options.onChangePage.call(this,e);this.options.target&&this.options.target.trigger("view:load-page",{page:e})}});return t})}(Application),function(e){e.widget("ToC",function(){function n(e,t){var r="<ul>";return _.each(e,function(e,i){i=i.split("_")[1],_.isPlainObject(e)?r+="<li>"+t(i)+n(e,t)+"</li>":r+='<li activate="toc" file="'+e+'">'+t(i)+"</li>"}),r+"</ul>"}var t=e.view({defaults:{title:"Table of Content",template:"<a>{{.}}</a>",toc:{"1_Topic A":"a.md","2_Topic B":{a_Overview:"b/b-intro.md","b_Topic B-1":"b/b-1.md","c_Topic B-2":"b/b-2.md","d_Topic B-3":{"1_Topic B-3-1":"b/b-3/3.md","1_Topic B-3-2":"b/b-3/2.md"}},"3_Topic C":"c.md"}},onBeforeRender:function(){var e=_.extend({},this.defaults,this.options);e.toc=_.size(this.get())?this.get():e.toc,this.template="<h3>"+e.title+"</h3>"+n(e.toc,_.partial(Marionette.Renderer.render,e.template))},onItemActivated:function(t,n){switch(n){case"toc":e.coop("load-topic-file",t.attr("file"));break;default:}}});return t})}(Application),function(e){e.widget("InfiniteGrid",function(){var t=e.view({className:"infinite-grid",attributes:{style:"height:100%; width:100%; position:relative; z-index:0;"},template:['<div class="outer-container" style="height:100%; width:100%; overflow-y:hidden; position:relative;">','<div class="inner-container" style="position: relative; top: 0;">','<div class="top-space-holder"></div>','<div class="contents" region="contents"></div>',"</div>","</div>",'<div class="infinite-grid-loading-icon hidden" style="position:absolute;top:0;bottom:0;left:0;right:0;z-index:1;text-align:center;background-color:rgba(155,155,155, 0.2);">','<i class="fa fa-3x fa-spin fa-spinner" style="position:absolute;top:40%;"></i>',"</div>"],initialize:function(t){var n=this;this.options.dataUrl||console.warn("Widget::InfiniteGrid::You need to specify the data attribute for infinite grid view..."),this.options=_.extend({rowHeight:25,rowView:e.view({template:"<span>ID: {{id}}</span> <span>IP: {{id}}.{{id}}.{{id}}.{{id}}</span>",attributes:{style:"height: 25px;width:100%;"}}),dataUrl:"/sample/infinite",totalKey:"total",dataKey:"payload",initialIndex:0,indexKey:"start",sizeKey:"size",params:{},scrollConstrain:!0},t),this._prevScrollTop=0,this._prevTop=0,this._batches=[],this._paramStr=_.reduce(_.pairs(this.options.params),function(e,t){return e+"&"+t.join("=")},""),this._showSpin=!1,this._prevScrollTimer=0,this._fastScrollLock=!1,this._smoothScrollLock=!1,this._prevIndex=0,this._currnetIndex=0;var r=this.options.rowView;this._SingleBatchView=e.view({className:"infinite-grid-single-batch-view",template:'<div region="singles"></div>',onReady:function(){this.more("singles",this.get("items"),r),this.$el.attr("batchIndex",this.get("batchIndex"))}})},onReady:function(){var e=this;this.trigger("view:reconfigure",{index:this.options.initialIndex},!0);var t;e.options.scrollConstrain?e.options.scrollConstrain===!0?t=e._viewportHeight/5:t=e.options.scrollConstrain:t=e._viewportHeight/4;var n=this.$el.find(".outer-container"),r=this.$el.find(".inner-container");n.on("mousewheel DOMMouseScroll",function(n){if(!e._fastScrollLock){var i=(new Date).getTime();if(i-e._prevScrollTimer>125){var s=0,o=window.event||n,u=Math.max(-1,Math.min(1,o.wheelDelta||-o.detail));o.preventDefault();var a=r.position().top,f;u>0?f=a+t>0?0:a+t:f=a-t<e._viewportHeight-e._totalHeight?e._viewportHeight-e._totalHeight:a-t,(f>=a+2*e._viewportHeight||f<=a-2*e._viewportHeight)&&e.$el.find(".infinite-grid-loading-icon").removeClass("hidden"),r.css({top:f+"px"}),e._scroll(f,a),e._prevScrollTimer=i}}})},onReconfigure:function(t,n){var r=this;this._viewportHeight=this.$el.find(".outer-container").height(),this._batchSize=Math.floor(this._viewportHeight/this.options.rowHeight),e.remote({url:this.options.dataUrl+"?"+this.options.indexKey+"="+t.index+"&"+this.options.sizeKey+"="+(t.size||this._batchSize*5)+this._paramStr,async:!1}).done(function(e){var i=r.options.dataKey?r._extactValue(e,r.options.dataKey):e,s=r._extactValue(e,r.options.totalKey),o=r.$el.find(".inner-container");if(s!==0&&!s)throw new Error("Stage.js::Widget::InfiniteGrid: there is no total amount of data provided...");if(!i)throw new Error("Stage.js::Widget::InfiniteGrid: there is no data provided...");if(s===0){console.warn("Stage.js::Widget::InfiniteGrid: there is no matched data returned from backend...");return}r._totalNumOfRecords=s,n?(r._totalHeight=r.options.rowHeight*r._extactValue(e,r.options.totalKey),o.css({height:r._totalHeight}),s%r._batchSize===0?(r._lastBatchRecords=r._batchSize,r._totalNumOfBatches=s/r._batchSize):(r._lastBatchRecords=s%r._batchSize,r._totalNumOfBatches=Math.floor(s/r._batchSize)+1),t.batchIndex=0,r._initBatch()):(r.$el.find(".top-space-holder").css({height:t.topHeight}),o.css({top:t.top+"px"}),r.$el.find(".infinite-grid-loading-icon").addClass("hidden")),i=_.reduce(i,function(e,t,n){return e[Math.floor(n/r._batchSize)].push(t),e},[[],[],[],[],[]]),_.map(i,function(e,n){i[n]={items:e,batchIndex:t.batchIndex+n}}),r.getViewIn("contents")&&r.getViewIn("contents").$el.empty(),_.defer(function(){r.more("contents",i,r._SingleBatchView,!0),_.defer(function(){r._fastScrollLock=!1})})}).fail(function(e){throw new Error("Stage.js::Widget::InfiniteGrid: error fetch data from url "+r.data+"...")})},_scroll:function(e,t){var n=this._calBatch(t),r=this._calBatch(e);if(r===n+1||n===this._prevIndex+1&&r===this._currnetIndex+1)this._smoothScroll(r,"down");else if(r===n-1||n===this._prevIndex-1&&r===this._currnetIndex-1)this._smoothScroll(r,"up");else if(r>n+1||r<n-1)this._fastScrollLock=!0,this._fastScroll(r);this._prevIndex=n,this._currnetIndex=r},_fastScroll:function(e){e>2&&e<this._batches.length-2?this.trigger("view:reconfigure",{index:this._batches[e].index,size:this._batchSize*5,batchIndex:e,top:this._batches[e].top,topHeight:e*this._viewportHeight}):e<=2?this.trigger("view:reconfigure",{index:this._batches[0].index,size:this._batchSize*5,batchIndex:0,top:this._batches[0].top,topHeight:0}):e>=this._batches.length-2&&this.trigger("view:reconfigure",{index:this._batches[this._batches.length-5].index,size:4*this._batchSize+this._lastBatchRecords,batchIndex:this._batches.length-5,top:this._batches[this._batches.length-2].top,topHeight:this._totalHeight-(4*this._batchSize+this._lastBatchRecords)*this.options.rowHeight})},_smoothScroll:function(t,n){if(!this._smoothScrollLock){var r=this,i=this.$el.find(".outer-container"),s,o=$(i.find(".infinite-grid-single-batch-view")[0]),u=$(i.find(".infinite-grid-single-batch-view")[4]),a=parseInt(o.attr("batchIndex")),f=parseInt(u.attr("batchIndex"));if(n==="up"&&a-1<0||t>this._batches.length-2||n==="down"&&(f+1>this._batches.length-1||t<2))return;this._smoothScrollLock=!0,n==="down"?e.remote({url:this.options.dataUrl+"?"+this.options.indexKey+"="+this._batches[f+1].index+"&"+r.options.sizeKey+"="+this._batchSize+this._paramStr,async:!1}).done(function(e){s=r.options.dataKey?r._extactValue(e,r.options.dataKey):e,o.data("view").close(),r.$el.find(".top-space-holder").css({height:(a+1)*r._viewportHeight}),r.more("contents",[{items:s,batchIndex:f+1}],r._SingleBatchView),r._smoothScrollLock=!1}):n==="up"&&e.remote({url:this.options.dataUrl+"?"+this.options.indexKey+"="+this._batches[a-1].index+"&"+r.options.sizeKey+"="+this._batchSize+this._paramStr,async:!1}).done(function(e){s=r.options.dataKey?r._extactValue(e,r.options.dataKey):e;var t=i.find(".infinite-grid-single-batch-view");$(t[t.length-1]).data("view").close();var n=r.getViewIn("contents"),o=r._SingleBatchView.create().render().set({items:s,batchIndex:a-1});n.$el.prepend(o.$el),r.$el.find(".top-space-holder").css({height:(a-1)*r._viewportHeight}),r._smoothScrollLock=!1})}},_initBatch:function(){for(var e=0;e<this._totalNumOfBatches;e++)this._batches.push({top:-(e*this._viewportHeight),scrollLimit:-((e+1)*this._viewportHeight),index:this.options.initialIndex+e*this._batchSize})},_calBatch:function(e){var t=_.findIndex(this._batches,function(t){return e<=t.top&&e>t.scrollLimit});return t},_extactValue:function(e,t){var n=t.split("."),r=e;for(var i=0;i<n.length;i++){if(r[n[i]]===undefined){r=undefined;break}r=r[n[i]]}return r}});return t})}(Application),Application.buildTimestamp=1525400069020