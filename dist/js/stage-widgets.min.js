(function(e){e.widget("Datagrid",function(){var t=e.view({tagName:"table",template:['<thead region="header"></thead>','<tbody region="body"></tbody>'],initialize:function(e){this.options=_.extend({data:[],details:!1,columns:[]},e)},onReady:function(){this.trigger("view:reconfigure",_.extend(this.options,{data:this.get("items",[])}))},onReconfigure:function(e){e=e||{},this.options=_.extend(this.options,e),_.each(this.options.columns,function(e){e.header=e.header||"string",e.cell=e.cell||e.header||"string",e.label=e.label||_.string.titleize(e.name)}),this.header.currentView||this.header.show(n.create({grid:this}));if(!this.body.currentView){var t=this,r=i.create({el:this.body.$el,grid:this}).on("all",function(e){/page-/.test(e)&&t.trigger.apply(t,arguments)});this.body.show(r)}this.header.currentView.set(this.options.columns),this.body.currentView.options=this.options,this.trigger("view:set-grid-data",this.options.data)},onSetGridData:function(e){this.body.currentView.set(e)},onLoadPage:function(e){this.body.currentView.trigger("view:load-page",e)},getBody:function(){return this.body.currentView},getHeader:function(){return this.header.currentView}}),n=e.view({type:"CollectionView",forceViewType:!0,itemView:"dynamic",itemViewEventPrefix:"headercell",tagName:"tr",initialize:function(e){this.grid=e.grid},buildItemView:function(t,n,r){var i=e.get(_.string.classify([t.get("header"),"header","cell"].join("-")),"Widget");return i.create({model:t,tagName:"th",row:this})}}),r=e.view({type:"CollectionView",forceViewType:!0,itemView:"dynamic",itemViewEventPrefix:"cell",tagName:"tr",triggers:{click:{event:"clicked",preventDefault:!1},dblclick:{event:"dblclicked",preventDefault:!1}},initialize:function(e){this.grid=e.body.grid},buildItemView:function(t,n,r){var i=e.get(_.string.classify([t.get("cell"),"cell"].join("-")),"Widget");return i.create({tagName:"td",model:t,row:this})}}),i=e.view({type:"CollectionView",forceViewType:!0,itemView:r,itemViewEventPrefix:"row",initialize:function(e){this.grid=e.grid},itemViewOptions:function(t,n){return{collection:e.collection(_.map(this.options.columns,function(r){return _.extend({value:e.extract(r.name||"",t.attributes),index:n},r)},this)),body:this}},itemEvents:{clicked:function(e,t){t.grid.trigger("row:clicked",t)},dblclicked:function(e,t){t.grid.trigger("row:dblclicked",t)}}});return t})})(Application),function(e){e.widget("StringHeaderCell",function(){var t=e.view({template:'<span><i class="{{icon}}"></i> {{{i18n label}}}</span>'});return t})}(Application),function(e){e.widget("StringCell",function(){var t=e.view({template:"<span>{{{value}}}</span>"});return t})}(Application),function(e){e.widget("SeqCell",function(){var t=e.view({template:"{{index}}"});return t})}(Application),function(e){e.widget("ActionCell",function(){var t=e.view({template:["{{#each actions}}",'<span class="action-cell-item" action="{{@key}}" data-toggle="tooltip" title="{{i18n tooltip}}"><i class="{{icon}}"></i> {{i18n label}}</span> ',"{{/each}}"],className:"action-cell",initialize:function(e){this.row=e.row;var t=this.model.get("actions")||{};_.each({preview:{icon:"glyphicon glyphicon-eye-open",tooltip:"Preview"},edit:{icon:"glyphicon glyphicon-pencil",tooltip:"Edit"},"delete":{icon:"glyphicon glyphicon-remove",tooltip:"Delete"}},function(e,n){t[n]&&(t[n]=_.extend(e,t[n]))}),this.actions=this.actions||{},_.each(t,function(e,t){e.fn&&(this.actions[t]=function(t){e.fn.apply(this.row,arguments)})},this),this.model.set("actions",t),this._enableActionTags(!0)},tooltips:!0});return t})}(Application),function(e){e.widget("Tree",function(){var t={type:"CompositeView",forceViewType:!0,tagName:"li",itemViewContainer:"ul",itemViewOptions:function(){return{parent:this}},className:function(){return _.size(this.model.get("children"))>=1?"node":"leaf"},initialize:function(t){this.parent=t.parent,this.className()==="node"&&(this.collection=e.collection(this.model.get("children"))),this.listenTo(this,"render",function(){this.$el.addClass("clickable").data({view:this,$children:this.$el.find("> ul"),$parent:this.parent&&this.parent.$el})})},template:['<a class="item" href="#"><i class="type-indicator"></i> <i class="{{icon}}"></i> {{{i18n val}}}</a>','<ul class="children hidden"></ul>']},n=e.view({type:"CollectionView",forceViewType:!0,className:"tree tree-root",tagName:"ul",initialize:function(n){this.itemView=this.options.itemView||e.view(_.extend({},t,_.omit(this.options.node,"type","tagName","itemViewContainer","itemViewOptions","className","initialize"))),this.onSelected=n.onSelected||this.onSelected},onShow:function(){this.trigger("view:reconfigure",this.options)},onReconfigure:function(e){_.extend(this.options,e),this.trigger("view:render-data",this.options.data)},events:{"click .clickable":function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.data();t.hasClass("node")&&this.trigger("view:toggleChildren",n),this.trigger("view:selected",t.data(),t,e)}},onToggleChildren:function(e){e.$children.toggleClass("hidden"),e.view.$el.toggleClass("expanded")},onSelected:function(e,t,n){}});return n})}(Application),function(e){e.widget("Paginator",function(){var t=e.view({className:"pagination",tagName:"ul",template:['<li {{#if atFirstPage}}class="disabled"{{/if}}><a href="#" action="goToFirstPage" data-page="--">'+_.escape("<<")+"</a></li>",'<li {{#if atFirstWindow}}class="hidden"{{/if}}><a href="#" action="goToAdjacentWindow" data-window="-">...</a></li>',"{{#each pages}}",'<li {{#if isCurrent}}class="active"{{/if}}><a href="#" action="goToPage" data-page="{{number}}">{{number}} <span class="sr-only">(current)</span></a></li>',"{{/each}}",'<li {{#if atLastWindow}}class="hidden"{{/if}}><a href="#" action="goToAdjacentWindow" data-window="+">...</a></li>','<li {{#if atLastPage}}class="disabled"{{/if}}><a href="#" action="goToLastPage" data-page="++">'+_.escape(">>")+"</a></li>"],initialize:function(e){this.options=_.extend({pageWindowSize:5},e),e.target&&this.listenTo(e.target,"view:page-changed",function(e){this.trigger("view:reconfigure",{currentPage:e.current,totalPages:e.total})})},onShow:function(){},onReconfigure:function(e){_.extend(this.options,e),this.options.currentWindow=Math.ceil(this.options.currentPage/this.options.pageWindowSize);var t={atFirstPage:this.options.currentPage===1,atLastPage:this.options.currentPage===this.options.totalPages,atFirstWindow:this.options.currentWindow===1,atLastWindow:this.options.currentWindow===Math.ceil(this.options.totalPages/this.options.pageWindowSize),pages:_.reduce(_.range(1,this.options.totalPages+1),function(e,t){return t>(this.options.currentWindow-1)*this.options.pageWindowSize&&t<=this.options.currentWindow*this.options.pageWindowSize&&e.push({number:t,isCurrent:t===this.options.currentPage}),e},[],this)};this.trigger("view:render-data",t)},actions:{goToPage:function(e,t){var n=e.data("page");if(n===this.options.currentPage)return;this.trigger("view:change-page",n)},goToFirstPage:function(e,t){this.trigger("view:change-page",1)},goToLastPage:function(e,t){this.trigger("view:change-page",this.options.totalPages)},goToAdjacentWindow:function(e,t){var n=this.options.currentWindow,r=e.data("window");r==="+"?n++:n--;if(n<1||n>Math.ceil(this.options.totalPages/this.options.pageWindowSize))return;this.trigger("view:change-page",n==1?1:(n-1)*this.options.pageWindowSize+1)}},onChangePage:function(e){if(this.options.onChangePage)return this.options.onChangePage.call(this,e);this.options.target&&this.options.target.trigger("view:load-page",{page:e})}});return t})}(Application)